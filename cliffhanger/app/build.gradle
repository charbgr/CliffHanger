apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'

android {
  compileSdkVersion rootProject.ext.compile_sdk_version
  buildToolsVersion rootProject.ext.build_tools_version

  defaultConfig {
    applicationId "com.github.charbgr.cliffhanger"
    minSdkVersion rootProject.ext.min_sdk_version
    targetSdkVersion rootProject.ext.target_sdk_version
    versionCode 1
    versionName "1.0"
    testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
  }

  packagingOptions {
    exclude 'LICENSE.txt'
    exclude 'META-INF/DEPENDENCIES'
    exclude 'META-INF/ASL2.0'
    exclude 'META-INF/NOTICE'
    exclude 'META-INF/LICENSE'
    exclude 'META-INF/rxjava.properties'
  }

  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  buildTypes {
    applicationVariants.all { variant ->
      def secrets = rootProject.getSecrets()
      variant.buildConfigField "String", "TMDB_API_KEY", secrets['TMDB_API_KEY']
    }
  }

  sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
  }
}


dependencies {
  def applicationDependencies = rootProject.ext.mainApplication
  def unitTestDependencies = rootProject.ext.unitTesting

  // Android Stuff
  implementation applicationDependencies.appCompat
  implementation applicationDependencies.design
  implementation applicationDependencies.constraintLayout

  // Reactive
  implementation applicationDependencies.rxJava
  implementation applicationDependencies.rxKotlin
  implementation applicationDependencies.rxAndroid
  implementation applicationDependencies.rxBinding
  implementation applicationDependencies.rxBindingDesign
  implementation applicationDependencies.rxBindingRecycler

  // Misc
  implementation applicationDependencies.kotlin
  implementation applicationDependencies.retrofit
  implementation applicationDependencies.retrofitAdapter
  implementation applicationDependencies.retrofitConverter
  implementation applicationDependencies.timber
  implementation applicationDependencies.glide


  // Unit/Integration tests dependencies
  testImplementation unitTestDependencies.kotlinTest
  testImplementation unitTestDependencies.mockitoKotlin
  testImplementation unitTestDependencies.kluent
  testImplementation unitTestDependencies.spek
//  testCompile unitTestDependencies.junit
  testImplementation unitTestDependencies.robolectric
}

repositories {
  mavenCentral()
  maven { url "http://dl.bintray.com/jetbrains/spek" }
}
