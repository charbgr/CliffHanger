apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'

android {
  compileSdkVersion rootProject.ext.compile_sdk_version
  buildToolsVersion rootProject.ext.build_tools_version

  defaultConfig {
    applicationId "com.github.charbgr.cliffhanger"
    minSdkVersion rootProject.ext.min_sdk_version
    targetSdkVersion rootProject.ext.target_sdk_version
    versionCode 1
    versionName "1.0"
    testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
  }

  packagingOptions {
    exclude 'LICENSE.txt'
    exclude 'META-INF/DEPENDENCIES'
    exclude 'META-INF/ASL2.0'
    exclude 'META-INF/NOTICE'
    exclude 'META-INF/LICENSE'
    exclude 'META-INF/rxjava.properties'
  }

  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  buildTypes {
    applicationVariants.all { variant ->
      def secrets = rootProject.getSecrets()
      variant.buildConfigField "String", "TMDB_API_KEY", secrets['TMDB_API_KEY']
    }
  }

  sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
  }
}


dependencies {
  def applicationDependencies = rootProject.ext.mainApplication
  def unitTestDependencies = rootProject.ext.unitTesting

  // Android Stuff
  compile applicationDependencies.appCompat
  compile applicationDependencies.design
  compile applicationDependencies.constraintLayout

  // Reactive
  compile applicationDependencies.rxJava
  compile applicationDependencies.rxKotlin
  compile applicationDependencies.rxAndroid
  compile applicationDependencies.rxBinding
  compile applicationDependencies.rxBindingDesign
  compile applicationDependencies.rxInterop

  // Misc
  compile applicationDependencies.kotlin
  compile applicationDependencies.conductor
  compile applicationDependencies.mosbyMviConductor
  compile applicationDependencies.retrofit
  compile applicationDependencies.retrofitAdapter
  compile applicationDependencies.retrofitConverter
  compile applicationDependencies.timber

  // Unit/Integration tests dependencies
  testCompile unitTestDependencies.kotlinTest
  testCompile unitTestDependencies.mockitoKotlin
  testCompile unitTestDependencies.kluent
  testCompile unitTestDependencies.spek
//  testCompile unitTestDependencies.junit
  testCompile unitTestDependencies.robolectric
}

repositories {
  mavenCentral()
  maven { url "http://dl.bintray.com/jetbrains/spek" }
}